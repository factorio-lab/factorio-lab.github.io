mod simplex;

use wasm_bindgen::prelude::*;

// When the `wee_alloc` feature is enabled, use `wee_alloc` as the global
// allocator.
#[cfg(feature = "wee_alloc")]
#[global_allocator]
static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;

#[wasm_bindgen(getter_with_clone)]
pub struct SimplexResult {
    // 0 = Solved, 1 = Error, 2 = Timeout
    pub result_type: usize,
    pub pivots: usize,
    pub time: f64,
    pub tableau: Box<[f64]>,
}

#[wasm_bindgen]
pub fn simplex(tableau: Box<[f64]>, rows: usize, timeout: f64) -> SimplexResult {
    let cols = tableau.len() / rows;
    let mut matrix = simplex::Matrix {
        tableau,
        rows,
        cols,
    };
    let (result_type, pivots, time) = simplex::simplex(&mut matrix, timeout);

    let result = SimplexResult {
        result_type: result_type,
        pivots: pivots,
        time: time,
        tableau: matrix.tableau,
    };

    return result;
}
