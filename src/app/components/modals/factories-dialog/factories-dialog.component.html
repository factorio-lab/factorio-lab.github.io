<p-dialog
  *ngIf="vm$ | async as vm"
  [(visible)]="visible"
  [modal]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [resizable]="false"
  [contentStyle]="{ height: '500px' }"
  [style]="{ width: '576px' }"
  [breakpoints]="{ '576px': '100vw' }"
  [header]="'factories.header' | translate"
>
  <p-table [value]="vm.factoryRows" styleClass="w-100">
    <ng-template pTemplate="header">
      <tr>
        <th style="max-width: 200px">{{ 'factories.factory' | translate }}</th>
        <th>{{ 'factories.modifiers' | translate }}</th>
        <th *ngIf="vm.data.game === Game.Satisfactory">
          {{ 'factories.overclock' | translate }}
        </th>
        <th *ngIf="vm.data.game === Game.Factorio">
          {{ 'factories.beacons' | translate }}
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-factoryId>
      <tr *ngIf="vm.factories.entities[factoryId] as factory">
        <td style="max-width: 200px">
          <p-dropdown
            *ngIf="factoryId; else defaultLabel"
            styleClass="w-100"
            [ngModel]="factoryId"
            [options]="vm.factoryOptions"
            appendTo="body"
          >
            <ng-template pTemplate="selectedItem" let-item>
              <div class="d-flex align-items-center">
                <i class="flex-shrink-0" [class]="item.value | iconClass"></i>
                <div class="ms-3 text-truncate">
                  {{ item.label }}
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-item>
              <div class="d-flex align-items-center">
                <i class="flex-shrink-0" [class]="item.value | iconClass"></i>
                <div class="ms-3 text-truncate">
                  {{ item.label }}
                </div>
              </div>
            </ng-template>
          </p-dropdown>
          <ng-template #defaultLabel
            ><span>{{ 'factories.default' | translate }}</span>
          </ng-template>
        </td>
        <td>
          <p-dropdown
            *ngIf="vm.data.game === Game.Satisfactory; else multiselectModifier"
          ></p-dropdown>
          <ng-template #multiselectModifier>
            <p-multiSelect
              [ngModel]="factory.moduleRankIds"
              placeholder="unused - breaks without this"
              [options]="vm.moduleOptions"
              appendTo="body"
            >
              <ng-template pTemplate="empty">
                <span>{{ 'factories.noModifiers' | translate }}</span>
              </ng-template>
              <ng-template pTemplate="selectedItems" let-items>
                <div *ngIf="items && items.length; else noModifiers">items</div>
                <ng-template #noModifiers>
                  <span>{{ 'factories.noModifiers' | translate }}</span>
                </ng-template>
              </ng-template>
              <ng-template pTemplate="item" let-item>
                <div class="d-flex align-items-center">
                  <i class="flex-shrink-0" [class]="item.value | iconClass"></i>
                  <div class="ms-3 text-truncate">
                    {{ item.label }}
                  </div>
                </div>
              </ng-template>
            </p-multiSelect>
          </ng-template>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>
