<p-card *ngIf="vm$ | async as vm" [header]="'objectives.title' | translate">
  <div class="objectives-content">
    <div
      *ngFor="
        let objective of vm.objectives;
        let i = index;
        trackBy: trackSvc.trackById
      "
      class="mb-1"
    >
      <div class="p-inputgroup">
        <button
          *ngIf="objective.unit === ObjectiveUnit.Machines; else itemButton"
          pButton
          pRipple
          type="button"
          class="p-button-outlined lab-button-icon-only text-truncate"
          [pTooltip]="'objectives.selectARecipe' | translate"
          tooltipPosition="top"
          (click)="
            editRecipePicker.clickOpen(
              vm.data,
              'recipe',
              vm.recipeIds,
              objective.targetId
            )
          "
        >
          <i
            class="p-button-icon"
            [class]="objective.targetId | iconSmClass: 'recipe'"
            ><span>#{{ objective.id }}</span></i
          >
          <span *ngIf="!vm.isMobile" class="p-button-label">{{
            vm.data.recipeEntities[objective.targetId].name
          }}</span>
        </button>
        <lab-picker
          #editRecipePicker
          [header]="'objectives.selectARecipe' | translate"
          (selectId)="setTarget(objective.id, $event)"
        ></lab-picker>
        <ng-template #itemButton>
          <button
            pButton
            pRipple
            type="button"
            class="p-button-outlined text-truncate"
            [icon]="objective.targetId | iconSmClass"
            [label]="
              vm.isMobile ? '' : vm.data.itemEntities[objective.targetId].name
            "
            [pTooltip]="'objectives.selectAnItem' | translate"
            tooltipPosition="top"
            (click)="
              editItemPicker.clickOpen(
                vm.data,
                'item',
                vm.itemIds,
                objective.targetId
              )
            "
          ></button>
          <lab-picker
            #editItemPicker
            [header]="'objectives.selectAnItem' | translate"
            (selectId)="setTarget(objective.id, $event)"
          ></lab-picker>
        </ng-template>
        <lab-input-number
          [pTooltip]="'objectives.valueTooltip' | translate"
          tooltipPosition="top"
          [hideButtons]="vm.isMobile"
          [value]="objective.value"
          (setValue)="setValue(objective.id, $event)"
        ></lab-input-number>
        <p-dropdown
          *ngIf="objective.type !== ObjectiveType.Maximize"
          labDropdownTranslate
          [tooltip]="'objectives.unitTooltip' | translate"
          tooltipPosition="top"
          [options]="vm.rateUnitOptions"
          [ngModel]="objective.unit"
          (onChange)="
            changeUnit(
              objective,
              $event.value,
              vm.data,
              chooseItemPicker,
              chooseRecipePicker
            )
          "
        ></p-dropdown>
        <p-dropdown
          labDropdownTranslate
          [tooltip]="'objectives.typeTooltip' | translate"
          tooltipPosition="top"
          [options]="objectiveTypeOptions"
          [ngModel]="objective.type"
          (onChange)="setType(objective.id, $event.value)"
        ></p-dropdown>
        <!-- Move options -->
        <ng-container *ngIf="!vm.isMobile">
          <button
            pButton
            pRipple
            type="button"
            class="p-button-text"
            icon="fa-solid fa-arrow-up"
            [pTooltip]="'settings.moveUp' | translate"
            tooltipPosition="top"
            [disabled]="i === 0"
            (click)="raiseObjective(objective.id)"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            class="p-button-text"
            icon="fa-solid fa-arrow-down"
            [pTooltip]="'settings.moveDown' | translate"
            tooltipPosition="top"
            [disabled]="i === vm.objectives.length - 1"
            (click)="lowerObjective(objective.id)"
          ></button>
        </ng-container>
        <button
          pButton
          pRipple
          type="button"
          class="p-button-text"
          icon="fa-solid fa-xmark"
          [pTooltip]="'objectives.removeTooltip' | translate"
          tooltipPosition="left"
          (click)="removeObjective(objective.id)"
        ></button>
      </div>
    </div>
    <div class="objectives-buttons d-flex flex-wrap mt-2">
      <button
        pButton
        pRipple
        type="button"
        class="flex-grow-1 p-button-outlined"
        icon="fa-solid fa-box"
        tooltipPosition="top"
        [label]="'objectives.addItems' | translate"
        (click)="addItemPicker.clickOpen(vm.data, 'item', vm.itemIds)"
      ></button>
      <button
        pButton
        pRipple
        type="button"
        class="flex-grow-1 p-button-outlined"
        icon="fa-solid fa-industry"
        tooltipPosition="top"
        [label]="'objectives.addMachines' | translate"
        (click)="addRecipePicker.clickOpen(vm.data, 'recipe', vm.recipeIds)"
      ></button>
      <p-dropdown
        labDropdownTranslate
        styleClass="h-100"
        [tooltip]="'objectives.selectDisplayRate' | translate"
        [ngModel]="vm.displayRate"
        [options]="displayRateOptions"
        (onChange)="setDisplayRate($event.value, vm.displayRate)"
      >
      </p-dropdown>
    </div>
  </div>
  <lab-picker
    #addItemPicker
    [header]="'objectives.selectAnItem' | translate"
    (selectId)="addItemObjective($event)"
  ></lab-picker>
  <lab-picker
    #addRecipePicker
    [header]="'objectives.selectARecipe' | translate"
    (selectId)="addRecipeObjective($event)"
  ></lab-picker>
  <lab-picker
    #chooseItemPicker
    [header]="'objectives.selectAnItem' | translate"
  ></lab-picker>
  <lab-picker
    #chooseRecipePicker
    [header]="'objectives.selectARecipe' | translate"
  ></lab-picker>
  <p-messages
    *ngIf="vm.messages.length"
    styleClass="mt-2 w-100"
    [value]="vm.messages"
    [closable]="false"
    [escape]="false"
  ></p-messages>
</p-card>
