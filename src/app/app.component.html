<lab-topbar (toggleMenu)="toggleMenu()"></lab-topbar>
<lab-menu [active]="menuActive" (toggleMenu)="toggleMenu()"></lab-menu>
<div
  class="layout-mask"
  [class.active]="menuActive"
  (click)="toggleMenu()"
></div>
<div class="layout-content">
  <main *ngIf="vm$ | async as vm" class="px-1 px-sm-4 px-xl-5 py-4">
    <ng-container *ngIf="vm.mod != null; else loading">
      <lab-products></lab-products>
    </ng-container>
    <ng-template #loading>
      <div class="d-flex flex-column align-items-center">
        <p-progressSpinner></p-progressSpinner>
      </div>
    </ng-template>
    <p-dialog
      [visible]="vm.errorMsg != null"
      [modal]="true"
      [draggable]="false"
      [resizable]="false"
      [closable]="false"
      [closeOnEscape]="false"
    >
      <ng-template pTemplate="header">
        <div class="p-dialog-title p-error">
          <i class="fa-solid fa-circle-exclamation me-2"></i>
          <span>{{ 'app.error' | translate }}</span>
        </div>
      </ng-template>
      <div class="p-error">
        <div>{{ 'app.errorDetail' | translate }}</div>
        <br />
        <div>{{ vm.errorMsg }}</div>
        <br />
        <div class="text-end">
          <button
            pButton
            pRipple
            [label]="'app.reset' | translate"
            (click)="reset(vm.game)"
          ></button>
        </div>
      </div>
    </p-dialog>
  </main>
</div>

<!-- <ng-container *ngIf="vm$ | async as vm">
  <ng-container *ngIf="(errorSvc.message$ | async) == null; else errorTile">
    <main *ngIf="vm.mod != null; else loading">
      <div *ngIf="showSettings" @slideLeftRight class="settings">
        <lab-settings (closeSettings)="showSettings = !showSettings">
        </lab-settings>
      </div>
      <div class="view">
        <div *ngIf="showPoll" class="poll">
          <h2>Poll</h2>
          <div class="panel">
            <a target="_blank" [href]="poll">Have a minute to answer a poll?</a>
            <div class="flex buttons">
              <button (click)="hidePoll(true)">
                <span class="text">Don't show again</span>
              </button>
              <button (click)="hidePoll()">
                <span class="text">Close</span>
              </button>
            </div>
          </div>
        </div>
        <lab-products></lab-products>
        <div *ngIf="vm.products.length">
          <ul role="navigation" class="tabs">
            <li
              routerLink="/list"
              routerLinkActive="active"
              queryParamsHandling="preserve"
            >
              <span>{{ 'app.list' | translate }}</span>
            </li>
            <li
              routerLink="/flow"
              routerLinkActive="active"
              queryParamsHandling="preserve"
            >
              <span>{{ 'app.flow' | translate }}</span>
            </li>
            <li
              routerLink="/matrix"
              routerLinkActive="active"
              queryParamsHandling="preserve"
            >
              <span>{{ 'app.matrix' | translate }}</span>
            </li>
            <li *ngIf="!showSettings" (click)="showSettings = true">
              <span>{{ 'app.settings' | translate }}</span>
            </li>
          </ul>
          <div class="panel">
            <router-outlet></router-outlet>
          </div>
        </div>
        <div>
          <div class="panel dark flex tween">
            <ng-container
              *ngIf="
                vm.result.resultType === MatrixResultType.Solved ||
                  vm.result.resultType === MatrixResultType.Cached;
                else notSolved
              "
            >
              <span *ngIf="vm.result.A && vm.result.O"
                >Simplex {{ vm.result.resultType }}: {{ vm.result.time }}ms,
                {{ vm.result.pivots }} pivots<br />
                Size: {{ vm.result.A.length }} x {{ vm.result.A[0].length }},
                Cost:
                {{ vm.result.O[vm.result.O.length - 1].toPrecision(2) }}
              </span>
            </ng-container>
            <ng-template #notSolved>
              <span>Simplex {{ vm.result.resultType }}</span>
            </ng-template>
            <span>{{ version }}</span>
          </div>
        </div>
      </div>
    </main>
  </ng-container>
  <ng-template #loading>
    <div class="view msg load">
      <div><div class="panel">Loading data, please wait...</div></div>
    </div>
  </ng-template>
  <ng-template #errorTile>
    <div class="view msg err">
      <div>
        <h2>Error</h2>
        <div class="panel invalid">
          <div>The application has encountered an error:</div>
          <br />
          <div>{{ errorSvc.message$ | async }}</div>
          <br />
          <a [href]="homeHref">Click here to reset</a>
        </div>
      </div>
    </div>
  </ng-template>
</ng-container> -->
