<ng-container *ngIf="vm$ | async as vm">
  <p-breadcrumb [home]="vm.home" [model]="vm.breadcrumb"></p-breadcrumb>
  <p-table
    #collectionTable
    [value]="vm.value"
    styleClass="p-datatable-sm"
    [paginator]="true"
    [rows]="25"
    [rowsPerPageOptions]="rowsPerPageOptions"
    [globalFilterFields]="['category.id']"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name">
          <span>{{ 'data.name' | translate }}</span>
          <p-sortIcon field="name"></p-sortIcon>
        </th>
        <th
          *ngIf="vm.collection.type !== 'category'"
          pSortableColumn="category.name"
        >
          <span>{{ 'data.category' | translate }}</span>
          <p-sortIcon field="category.name"></p-sortIcon>
        </th>
      </tr>
      <tr>
        <th>
          <p-columnFilter type="text" field="name"></p-columnFilter>
        </th>
        <th *ngIf="vm.collection.type !== 'category'">
          <p-columnFilter field="category.id" matchMode="in">
            <ng-template
              pTemplate="filter"
              let-value
              let-filter="filterCallback"
            >
              <p-multiSelect
                appendTo="body"
                [ngModel]="value"
                [options]="vm.options.categories"
                [maxSelectedLabels]="1"
                [selectedItemsLabel]="'data.selectedLabel' | translate"
                [placeholder]="'data.any' | translate"
                (onChange)="filter($event.value)"
              ></p-multiSelect>
            </ng-template>
          </p-columnFilter>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-obj>
      <tr>
        <td>
          <a [routerLink]="obj.id" queryParamsHandling="preserve">
            <button
              pButton
              pRipple
              type="button"
              class="p-button-link"
              [label]="obj.name"
              [icon]="obj.id | iconClass : vm.collection.type"
            ></button>
          </a>
        </td>
        <td *ngIf="vm.collection.type !== 'category'">
          <a
            [routerLink]="'/data/categories/' + obj.category.id"
            queryParamsHandling="preserve"
          >
            <button
              pButton
              pRipple
              type="button"
              class="p-button-link"
              [label]="obj.category.name"
              [icon]="obj.category.id | iconClass : 'category'"
            ></button>
          </a>
        </td>
      </tr>
    </ng-template>
  </p-table>
</ng-container>
